#!/usr/bin/env bash
set -e

# Construit un nouveau /etc/hosts en tête avec les entrées demandées,
# puis le contenu actuel (sans dupliquer ces deux lignes).
tmp="$(mktemp)"
{
  echo "127.0.0.2 localhost"
  echo "8.8.8.8 facebook.com"
  # Ajoute les anciennes lignes en excluant celles qu'on vient de définir
  grep -vE '^\s*127\.0\.0\.(1|2)\s+localhost(\s|$)' /etc/hosts \
  | grep -vE '^\s*8\.8\.8\.8\s+facebook\.com(\s|$)'
} > "$tmp"

# Sauvegarde et remplacement atomique
sudo cp /etc/hosts /etc/hosts.bak || true
sudo mv "$tmp" /etc/hosts
